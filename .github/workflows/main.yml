name: Night Access Alert (IST)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  night-access-check:
    runs-on: ubuntu-latest

    steps:

      # 1ï¸âƒ£ Get India Time (IST)
      - name: Get India Time
        id: timecheck
        run: |
          HOUR=$(TZ="Asia/Kolkata" date +'%H')
          TIME_NOW=$(TZ="Asia/Kolkata" date +"%H:%M")

          echo "TIME_NOW=$TIME_NOW" >> $GITHUB_ENV

          # Check if time is between 7 PM (19) and 7 AM (07)
          if [ "$HOUR" -ge 19 ] || [ "$HOUR" -lt 7 ]; then
            echo "night_time=true" >> $GITHUB_ENV
          else
            echo "night_time=false" >> $GITHUB_ENV
          fi


      # 2ï¸âƒ£ Send Email Only at Night
      - name: Send Night Alert Email
        if: env.night_time == 'true'
        uses: dawidd6/action-send-mail@v3

        with:
          server_address: smtp.gmail.com
          server_port: 587

          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}

          subject: "ğŸš¨ Night Access Alert (7PMâ€“7AM IST)"

          to: ${{ secrets.ADMIN_EMAIL }}

          body: |
            âš ï¸ Night Access Detected!

            Someone accessed the repository at restricted hours.

            ğŸ‘¤ User: ${{ github.actor }}
            ğŸ“¦ Repository: ${{ github.repository }}
            ğŸ“Œ Event: ${{ github.event_name }}
            ğŸ•’ Time (IST): ${{ env.TIME_NOW }}
            ğŸŒ¿ Branch: main

            This activity happened between 7 PM and 7 AM (IST).

            Please review if this was authorized.
